<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Note de D√©placement ‚Äî G√©n√©rateur PDF</title>
  <link rel="stylesheet" href="style.css" />
  <!-- PDF-Lib (fusion + g√©n√©ration PDF) -->
  <script defer src="https://unpkg.com/pdf-lib/dist/pdf-lib.min.js"></script>
  <script defer src="app.js"></script>
</head>
<body>
  <header class="container">
    <div class="header-top">
      <div class="header-title">
        <a href="https://www.lbfco.fr" target="_blank" rel="noopener noreferrer">
          <img class="header-logo" src="logos/LBFCO.png" alt="Logo LBFCO" />
        </a>
        <h1 id="pageTitle">Note de frais</h1>
      </div>
      <div class="header-actions">
        <button id="themeToggle" class="btn theme-toggle" type="button" role="switch" aria-checked="false" aria-label="Basculer le th√®me">
          <span class="theme-toggle-label">Th√®me</span>
          <span class="theme-toggle-switch" aria-hidden="true">
            <span class="theme-toggle-icons" aria-hidden="true">
              <span class="theme-toggle-icon theme-toggle-icon-sun">‚òÄÔ∏è</span>
              <span class="theme-toggle-icon theme-toggle-icon-moon">üåô</span>
            </span>
            <span class="theme-toggle-thumb"></span>
          </span>
        </button>
        <button id="helpBtn" class="btn help-btn" type="button" aria-haspopup="dialog" aria-controls="helpModal" aria-label="Aide">?</button>
      </div>
    </div>
    <p class="muted">Remplis le r√©cap, ajoute tes justificatifs (PDF/JPG/PNG), puis g√©n√®re un PDF unique. Transmettre le document √† la tr√©sori√®re</p>
  </header>

  <main class="container">
    <section class="card">
      <h2>Informations</h2>
      <div class="form-grid">
        <label>
          Nom / Pr√©nom
          <input id="nom" type="text" placeholder="Ex: Jean Dupont" />
        </label>
        <label>
          Adresse
          <input id="adresse" type="text" placeholder="Ex: 10 rue de la Lib√©ration, 21320 Vandenesse-en-Auxois" />
        </label>
        <label>
          Motif
          <input id="motif" type="text" placeholder="Ex: Rendez-vous des Ligues" />
        </label>
        <label>
          Lieu
          <input id="lieu" type="text" placeholder="Ex: Maison des Sports de Besan√ßon" />
        </label>
        <label>
          Date
          <input id="dateMission" type="date" />
        </label>
      </div>

      <div class="row">
        <button id="addRowBtn" class="btn">‚ûï Ajouter une ligne</button>
        <button id="clearBtn" class="btn btn-ghost" title="Efface lignes + justificatifs">R√©initialiser</button>
      </div>

      <h2>Lignes de frais</h2>
      <div class="table-wrap">
        <table id="fraisTable">
          <thead>
            <tr>
              <th></th>
              <th>Cat√©gorie</th>
              <th>Description</th>
              <th class="num">Km</th>
              <th class="num">Montant (‚Ç¨)</th>
              <th>Justificatif</th>
              <th></th>
            </tr>
          </thead>
          <tbody id="fraisBody"></tbody>
          <tfoot>
            <tr>
              <td colspan="4" class="right"><strong>Total</strong></td>
              <td class="num"><strong id="totalEuros">0,00</strong></td>
              <td colspan="2"></td>
            </tr>
            <tr id="leagueShareRow" hidden>
              <td colspan="4" class="right"><strong>Pris en charge ligue (30%)</strong></td>
              <td class="num"><strong id="leagueShareEuros">0,00</strong></td>
              <td colspan="2"></td>
            </tr>
          </tfoot>
        </table>
      </div>

      <div class="total-mobile" aria-live="polite">
        <span class="muted">Total</span>
        <strong id="totalEurosMobile">0,00</strong>
      </div>

      <div id="leagueShareMobile" class="total-mobile" aria-live="polite" hidden>
        <span class="muted">Pris en charge ligue (30%)</span>
        <strong id="leagueShareEurosMobile">0,00</strong>
      </div>

      <p class="hint">
        Astuce : tu peux associer un justificatif √† une ligne en s√©lectionnant un fichier dans la colonne <strong>Justificatif</strong>.
      </p>

      <hr />

      <h2>G√©n√©ration</h2>
      <div class="gen-bar">
        <div class="gen-bar-left-col">
          <label class="row gen-bar-left">
            <input id="renonceIndemnites" type="checkbox" />
            <span>Je soussign√© renoncer au remboursement de mes frais, j'en fais don √† la ligue Bourgogne Franche-Comt√© et demande un re√ßu fiscal.</span>
          </label>

          <label class="row gen-bar-left">
            <input id="demandeRemboursement" type="checkbox" />
            <span>Je demande le remboursement de mes frais.</span>
          </label>
        </div>

        <div class="gen-bar-right">
          <button id="generateBtn" class="btn btn-primary btn-xl">üìÑ G√©n√©rer le PDF final</button>
          <button id="downloadBtn" class="btn btn-xl" disabled>T√©l√©charger</button>
        </div>
      </div>

      <div id="pdfPreviewWrap" class="preview" hidden>
        <iframe id="pdfPreview" title="Aper√ßu PDF" class="preview-frame"></iframe>
      </div>

      <p class="muted small">
        Remarque : tout se fait dans ton navigateur (pas d‚Äôenvoi serveur). Selon la taille des fichiers, √ßa peut prendre quelques secondes.
      </p>

      <div id="status" class="status" aria-live="polite"></div>
    </section>
  </main>

  <footer class="container footer">
    <span class="muted small">D√©velopp√© par Jerome PERRIN ‚Äî ¬© Tous droits r√©serv√©s </span>
  </footer>

  <div id="helpModal" class="modal-overlay" role="dialog" aria-modal="true" aria-labelledby="helpTitle" hidden>
    <div class="modal" role="document">
      <div class="modal-header">
        <h2 id="helpTitle" class="modal-title">Aide</h2>
        <button id="helpCloseBtn" class="btn btn-ghost" type="button" aria-label="Fermer">Fermer</button>
      </div>

      <div class="modal-body">
        <p><strong>1.</strong> Renseigne tes informations (nom, adresse, motif, lieu, date).</p>
        <p><strong>2.</strong> Ajoute tes lignes de frais (d√©placement, repas, etc.).</p>
        <p><strong>3.</strong> Ajoute tes justificatifs (PDF/JPG/PNG), puis clique sur <strong>G√©n√©rer</strong>.</p>
        <p><strong>4.</strong> T√©l√©charge le PDF final et transmets-le √† la tr√©sori√®re par mail.</p>
        <p class="muted small">Astuce : tu as la possibilit√© de d√©placer les lignes pour r√©organiser l'ordre.</p>
      </div>

      <div class="modal-actions">
        <button id="helpOkBtn" class="btn btn-primary" type="button">OK</button>
      </div>
    </div>
  </div>

  <div id="expenseTypeModal" class="modal-overlay" role="dialog" aria-modal="true" aria-labelledby="expenseTypeTitle" hidden>
    <div class="modal" role="document">
      <div class="modal-header">
        <h2 id="expenseTypeTitle" class="modal-title">Type de frais</h2>
        <button id="expenseTypeCloseBtn" class="btn btn-ghost" type="button" aria-label="Fermer">Fermer</button>
      </div>

      <div class="modal-body">
        <label>
          S√©lectionne le type de frais
          <select id="expenseTypeSelect">
            <option value="Frais de d√©placement">Frais de d√©placement</option>
            <option value="Frais de formation 30%">Frais de formation 30%</option>
            <option value="Frais de formation f√©minine 100 %">Frais de formation f√©minine 100 %</option>
            <option value="Frais divers">Frais divers</option>
          </select>
        </label>
      </div>

      <div class="modal-actions">
        <button id="expenseTypeValidateBtn" class="btn btn-primary" type="button">Valider</button>
      </div>
    </div>
  </div>
</body>
</html>
